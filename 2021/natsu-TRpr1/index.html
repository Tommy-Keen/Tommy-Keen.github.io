<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/4.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/4.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="j1x0aj8z_yTzMf4418HVYztivD-T9K_6wF6q48fGAm4">
  <meta name="msvalidate.01" content="de7409d7fe91436eab14ea4062b1ba87">
  <meta name="baidu-site-verification" content="7kBMv6UJrb5yCmuU">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"miku01ck.xyz","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.9.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="树上问题可谓是老生常谈，家喻户晓了。凭着老少皆宜，童叟无欺，毒瘤遍地，常数离奇，复杂度迷等特点使 NOI 系列比赛出了很多奇葩树据结构题。 那么我们就开始吧！ 设 \((x \rightarrow y)\) 为存在由节点 \(x\) 到节点 \(y\) 的路径。">
<meta property="og:type" content="article">
<meta property="og:title" content="树上问题α">
<meta property="og:url" content="https://miku01ck.xyz/2021/natsu-TRpr1/index.html">
<meta property="og:site_name" content="Sz_zUwu&#39;s blog">
<meta property="og:description" content="树上问题可谓是老生常谈，家喻户晓了。凭着老少皆宜，童叟无欺，毒瘤遍地，常数离奇，复杂度迷等特点使 NOI 系列比赛出了很多奇葩树据结构题。 那么我们就开始吧！ 设 \((x \rightarrow y)\) 为存在由节点 \(x\) 到节点 \(y\) 的路径。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2021-08-07T14:53:46.000Z">
<meta property="article:modified_time" content="2021-12-19T09:46:19.186Z">
<meta property="article:author" content="Sz_zUwu">
<meta property="article:tag" content="树上问题">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://miku01ck.xyz/2021/natsu-TRpr1/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://miku01ck.xyz/2021/natsu-TRpr1/","path":"2021/natsu-TRpr1/","title":"树上问题α"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>树上问题α | Sz_zUwu's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Sz_zUwu's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">φ(゜▽゜*)♪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-友链"><a href="/links/" rel="section"><i class="fas fa-user-friends fa-fw"></i>友链</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签<span class="badge">54</span></a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类<span class="badge">9</span></a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档<span class="badge">98</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84-lca-%E5%BC%80%E5%A7%8B"><span class="nav-number">1.</span> <span class="nav-text">从最基本的 LCA 开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E7%9D%80%E7%BB%8F%E5%85%B8%E9%A2%98%E8%B5%B0%E4%B8%80%E6%B3%A2"><span class="nav-number">1.1.</span> <span class="nav-text">接着经典题走一波。</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E4%B8%8A%E5%B7%AE%E5%88%86"><span class="nav-number">2.</span> <span class="nav-text">树上差分</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%91%E7%9A%84%E7%9B%B4%E5%BE%84"><span class="nav-number">3.</span> <span class="nav-text">树的直径</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Sz_zUwu"
      src="/images/1.jpg">
  <p class="site-author-name" itemprop="name">Sz_zUwu</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">98</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">54</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Sz-zUwu" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Sz-zUwu" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://space.bilibili.com/295357491" title="BiliBili → https:&#x2F;&#x2F;space.bilibili.com&#x2F;295357491" rel="noopener" target="_blank"><i class="fas fa-tv fa-fw"></i>BiliBili</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://music.163.com/#/user/home?id=564152236" title="网易云音乐 → https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;564152236" rel="noopener" target="_blank"><i class="fas fa-music fa-fw"></i>网易云音乐</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;" rel="noopener" target="_blank"><i class="fas fa-blog fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.luogu.com.cn/user/444418" title="洛谷 → https:&#x2F;&#x2F;www.luogu.com.cn&#x2F;user&#x2F;444418" rel="noopener" target="_blank"><i class="fas fa-code fa-fw"></i>洛谷</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://loj.ac/u/Sz_zUwu" title="LibreOJ → https:&#x2F;&#x2F;loj.ac&#x2F;u&#x2F;Sz_zUwu" rel="noopener" target="_blank"><i class="fas fa-code fa-fw"></i>LibreOJ</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.pixiv.net/users/61482901" title="pixiv → https:&#x2F;&#x2F;www.pixiv.net&#x2F;users&#x2F;61482901" rel="noopener" target="_blank"><i class="fas fa-image fa-fw"></i>pixiv</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://codeforces.com/profile/Sz_zUwu" title="Codeforces → https:&#x2F;&#x2F;codeforces.com&#x2F;profile&#x2F;Sz_zUwu" rel="noopener" target="_blank"><i class="fas fa-coffee fa-fw"></i>Codeforces</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


	</header>

		
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


		<div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://miku01ck.xyz/2021/natsu-TRpr1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/1.jpg">
      <meta itemprop="name" content="Sz_zUwu">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Sz_zUwu's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          树上问题α
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-08-07 22:53:46" itemprop="dateCreated datePublished" datetime="2021-08-07T22:53:46+08:00">2021-08-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2021-12-19 17:46:19" itemprop="dateModified" datetime="2021-12-19T17:46:19+08:00">2021-12-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/OI/" itemprop="url" rel="index"><span itemprop="name">OI</span></a>
        </span>
    </span>
 

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>9 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>树上问题可谓是老生常谈，家喻户晓了。凭着老少皆宜，童叟无欺，毒瘤遍地，常数离奇，复杂度迷等特点使
NOI 系列比赛出了很多奇葩树据结构题。</p>
<p>那么我们就开始吧！</p>
<p>设 <span class="math inline">\((x \rightarrow y)\)</span>
为存在由节点 <span class="math inline">\(x\)</span> 到节点 <span
class="math inline">\(y\)</span> 的路径。</p>
<span id="more"></span>
<h2 id="从最基本的-lca-开始">从最基本的 LCA 开始</h2>
<p>此 LCA 非彼 lca（某候选队爷），但是相信大家都明白 LCA
到底是个什么，这里不做赘述。</p>
<p>你说，你会 LCA，那我便考你一考。。。</p>
<p>LCA，究竟是甚么意思啊？</p>
<p>不就是最近公共祖先吗，<del>去 LOJ 看 lca 的头像啊</del>。</p>
<p>对呀对呀！......LCA 有四种求法，你知道吗?</p>
<p>编不下去了。 QwQ</p>
<p>LCA 有倍增、树剖、Tarjan、欧拉序 <span
class="math inline">\(+\)</span> RMQ 四种常见求法。</p>
<p>那么有人会问了：向上标记法呢？</p>
<p>呐。。请问各位写过它吗（</p>
<p><del>写过当我没说</del></p>
<p>咳咳，实际上是因为这个算法太过返璞归真，就跟解方程时遍历集合 <span
class="math inline">\(R\)</span> 来求解类似。</p>
<p>而那四种多半都是对这个算法的优化。</p>
<p>倍增最好写，实质上是对向上标记法的倍增优化。就是</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">if</span><span class="token punctuation">(</span>d<span class="token punctuation">[</span>f<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token operator">>=</span>d<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> y<span class="token operator">=</span>f<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 一定要写大于等于啊！！！</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或者写</p>
<pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>j<span class="token operator">=</span>dep<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token operator">-</span>dep<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">;</span>j<span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">,</span>j<span class="token operator">>>=</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">if</span><span class="token punctuation">(</span>j<span class="token operator">&amp;</span><span class="token number">1</span><span class="token punctuation">)</span> y<span class="token operator">=</span>f<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>我在这里出错好多次了（暴露了我的菜。</p>
<p>倍增与树形 dp 非常相似，算法的流程简单明了。</p>
<p>设 <span class="math inline">\(f(x,k)\)</span> 为节点 <span
class="math inline">\(x\)</span> 的第 <span
class="math inline">\(2^k\)</span> 个祖先，显然转移为 <span
class="math display">\[
\large f(x,k)=f(f(x,k-1),k-1) \quad k \le log_2n
\]</span> 在 DFS / BFS 预处理节点深度的时候可以顺便求出 <span
class="math inline">\(f\)</span> 数组。</p>
<p>顺带一提 DFS / BFS
的同时还可以求出与每个节点到根的距离，然后求两点间的最小距离。实际应用时，应根据要预处理出的信息选择两种遍历方式，<del>但还是
DFS 好写，用处更多</del>。</p>
<p>查询的时候，对于点 <span
class="math inline">\((x,y)\)</span>，将它们置于同一深度，然后。 <span
class="math display">\[
\text{You jump I jump!}
\]</span> 通过 <span class="math inline">\(k\)</span> 递减顺序不断让
<span class="math inline">\((x,y)\)</span> 往上
“跳”，比较祖先就行了。</p>
<p>复杂度为</p>
<p>预处理 <span class="math inline">\(O(n \times log_2n)\)</span></p>
<p>单次查询 <span class="math inline">\(O(log_2n)\)</span></p>
<p><del>就是容易被卡</del></p>
<p> </p>
<p>Tarjan
同（du）志（liu）的算法是一个离线算法，实质上是对向上标记法的并查集优化。</p>
<p>但是实在是不常用，最起码我没在实际做题时用过。</p>
<p>Tarjan 同志的算法一向思路巧妙。</p>
<p>此算法将「访问完毕并且回溯的节点」标记为2，「访问了且尚未回溯的节点」标记为1，其余为0。同时开始时每个节点各自为一个集合。</p>
<p>用并查集维护「上一个回溯的父节点」。</p>
<p>但是我说不清楚。。很巧妙的算法，并且这位同志证明了每次查询为 <span
class="math inline">\(O(1)\)</span>。</p>
<p>预处理 <span class="math inline">\(O(n)\)</span>。</p>
<p>处理询问 <span class="math inline">\(O(n+m)\)</span>，<span
class="math inline">\(m\)</span> 为询问个数。</p>
<p>就是常数有时比倍增还难看</p>
<p>在此不再赘述。</p>
<p>至于树剖和欧拉序 <span class="math inline">\(+\)</span>
RMQ，我还没有系统地去学习，大概下一篇树上问题博客会说一下。</p>
<h3 id="接着经典题走一波">接着经典题走一波。</h3>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5836">Milk Visits</a></p>
<p>累加每条路径的权，查询两件间距离时候大于0即可。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3398">仓鼠找sugar</a></p>
<p>设 <span class="math inline">\(dis(x,y)\)</span> 为 <span
class="math inline">\((x \rightarrow y)\)</span> 的最短路径长度。</p>
<p>如果 $(u v) $ 和 <span class="math inline">\((p \rightarrow
q)\)</span> 的最短路径相交，那么有 <span class="math display">\[
\large dis(LCA(u,v),p)+dis(LCA(u,v),q)=dis(p,q)
\]</span> 或者 <span class="math display">\[
\large dis(LCA(p,q),u)+dis(LCA(p,q),v)=dis(u,v)
\]</span></p>
<p> </p>
<p>也就是有一条路径的 LCA 在另一条路径上。</p>
<p>稍加思索不难证明。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1967">货车运输</a></p>
<p>题目要求不超过限重，不难想到因该最大化每条路的限重。所以在原图上求出最大生成树。</p>
<p>那么对于点 <span class="math inline">\((x,y)\)</span>，如果在并查集中
<span class="math inline">\(x\)</span> 与 <span
class="math inline">\(y\)</span> 不在同一个集合，则 <span
class="math inline">\(x\)</span> 不能到达 <span
class="math inline">\(y\)</span>。</p>
<p>接下来就是每辆车最多运送的货物，不难想到最多运送的货物就是 <span
class="math inline">\((x \rightarrow y)\)</span>
路径上权值最小的边。</p>
<p>如果用朴素的算法去求最小的边权，那么复杂度会上天，<span
class="math inline">\(O(n)\)</span>。</p>
<p>联系我们对想上标记法的倍增优化，不难想到对求路径上最小的边权进行倍增优化。</p>
<p>设 <span class="math inline">\(d(x,k)\)</span> 为节点 <span
class="math inline">\(x\)</span> 到它的 <span
class="math inline">\(2^k\)</span> 辈祖先这条路径上最小的边权。</p>
<p>接着不难想到转移 <span class="math display">\[
\large d(x,k)=\min{ \{ d(x,k-1),d(f(x,k-1),k-1) \} } \quad k \le log_2n
\]</span> 可以在求 <span class="math inline">\(f\)</span>
数组的同时求出。</p>
<p>所以，在求 LCA 的过程中不断维护路径上最小的 <span
class="math inline">\(d(x,k)\)</span>。</p>
<p>这题毒瘤数据，给出的图不一定联通。</p>
<p>顺带一提，<span class="math inline">\(d\)</span>
数组是什么，怎么转移，在第一页且算法相同的题解中，只有神鱼讲到了。某些人直接一笔带过甚至完全没有提到过。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4281">紧急集合 /
聚会</a></p>
<p>三个点两两求出 LCA，三个点的深度减去它们 LCA 的深度就是答案2。</p>
<p>而三个点 LCA 中必定有两个点相同，那个不同的即为答案1。</p>
<p>至于证明。。画图是显然的，但是论述的话感觉很多思路都不是那么有说服力，就不献丑了，自己说的自己都不能完全信。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P4427">求和</a></p>
<p>大概是 LCA+树上差分，但又没去差分，仅仅是用了它的思路。</p>
<p>由于指数范围较小，我们设 <span class="math inline">\(g(x,k)\)</span>
为根节点到节点 <span class="math inline">\(x\)</span> 路径上点权的 <span
class="math inline">\(k\)</span> 次方和，在 DFS 时维护，设 <span
class="math inline">\(dep(x)\)</span> 为节点 <span
class="math inline">\(x\)</span> 的深度。不难想到转移 <span
class="math display">\[
\large g(x,k)=g(y,k)+(dep(x)-1)^k \quad (y \rightarrow x)
\]</span> 这是建立在点上的，可以看作点权，求路径上的点权和。</p>
<p>我们知道，两点之间路径的点权和可以表示为 <span
class="math display">\[
\large ty(x)+ty(y)-ty(z)-ty(f(z,0)) \quad z=LCA(x,y)
\]</span> 其中 <span class="math inline">\(ty(x)\)</span> 必须是根节点到
<span class="math inline">\(x\)</span> 点的点权和，画图不难证明。</p>
<p>所以这题就可以切了。 <span class="math display">\[
\large g(x,k)+g(y,k)-g(z,k)-g(f(z,0),k) \quad z=LCA(x,y)
\]</span> 注意要加上 <span class="math inline">\(mod\)</span>
的两倍，不然会当场去世（</p>
<p>同时，借着这题说一下树上差分。</p>
<h2 id="树上差分">树上差分</h2>
<p>差分本是对序列的操作，是前缀和的逆运算。树上差分就是将树上点/边的区间操作转化为差分，用前缀和求出维护的信息。</p>
<p>大概就是这种思想，没啥可说的，通常与 LCA 结合。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://loj.ac/p/10131">暗的连锁</a></p>
<p>经典题目，显然加入非树边 <span class="math inline">\((x \rightarrow y
)\)</span> 之后会形成一个环，将树上 <span class="math inline">\((x
\rightarrow y)\)</span> 的边上任意一边斩断，再斩断非树边，就可以击败
Dark。</p>
<p>姑且称非树边 <span class="math inline">\((x \rightarrow y )\)</span>
将将树上 <span class="math inline">\((x \rightarrow y)\)</span>
的路径「覆盖」了一次，不难想到，如果树边 <span class="math inline">\((u
\rightarrow v)\)</span>
被「覆盖」了多于一次，那么无论如何都不存在合法的方式将 Dark 斩断。</p>
<p>同时不难想到，如果一条树边没有被「覆盖」，那么将其斩断后再任意斩断一条非树边就能达到目的。
这题差分的是边权，求子树边权和，仿照上题的叙述方式，则有 <span
class="math display">\[
\large ty(x)+ty(y)-ty(z)-ty(z) \quad z=LCA(x,y)
\]</span> 是不是很像求两点间的距离？</p>
<p>所以开一个 <span class="math inline">\(w\)</span> 数组，如果有 <span
class="math inline">\((x \rightarrow y)\)</span>，就令 <span
class="math display">\[
w(x)+1,w(y)+1,w(z)-2 \quad z=LCA(x,y)
\]</span> 通过 DFS 累加子树的 <span
class="math inline">\(w\)</span>，最后求出方案数即可。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3128">Max Flow</a></p>
<p>与上题的区别仅仅是 「差分的是点权，求最大子树边权和」，在累加差分数组
<span class="math inline">\(w\)</span> 时取每颗子树的最大值即可。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P3258">松鼠的新家</a></p>
<p>差分的是点权，求每个点的访问次数。给出的访问顺序两两求出 LCA
并且差分，与前两题基本相同。</p>
<p>注意最后需要将访问顺序 $ w(a_i)-1 i n $ ，因为差分时会多加一次。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P6869">Putovanje</a></p>
<p>稍加思索不难发现，为了最小化费用，第 <span
class="math inline">\(i\)</span>
条边只能用单程票或多程票，并且取决于经过 <span
class="math inline">\(i\)</span> 的次数。</p>
<p>题目要求按照编号大小访问，不难想到两个点间的最短路径必定经过其
LCA，所以在倍增求 LCA 的时候将路径差分，最后用一次 DFS
求出每条边的访问次数，即<span class="math inline">\(g\)</span>
数组。</p>
<p>然后取 $ $​​​，累加 <span class="math inline">\(ans\)</span>​​​</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/CF191C">Fools and
Roads</a></p>
<p>题意很简单：有一颗 <span class="math inline">\(n\)</span>
个节点的树，<span class="math inline">\(k\)</span>
次旅行，问每一条边被走过的次数。</p>
<p>淼题，。，注意要按照边的顺序输出。</p>
<p> </p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P1600">天天爱跑步</a></p>
<p>有名的毒瘤题。</p>
<p>通过简单推式子与转化为树上区间问题来解决。</p>
<p>lyd
在他的蓝书中已经讲得很清楚了，<del>懒得讲了</del>，就不献丑了。</p>
<h2 id="树的直径">树的直径</h2>
<p>通常意义上，直径为树上的最长链，可能有多条。</p>
<p>证明略，因为不知道问什么在 hexo 上报错。</p>
<p>两次 DFS / BFS
的思路都是相同的，都用到了「从一个节点出发能够到达的最远的节点一定是直径的一端」。</p>
<p>从任意节点出发记录最远能够到达的节点，它是直径的一端，再以它为起点记录最远能够到达的距离，显然那是另一端。</p>
<p>证明的话，写出的难度大于想到的难度，放个链接，<a
target="_blank" rel="noopener" href="https://oi-wiki.org/graph/tree-diameter/">OI wiki</a></p>
<p>复杂度是显然的。</p>
<p>树形 dp
能优美地求出直径长度，并且能处理负权的情况，缺点也很明显，即相较于纯粹的
DFS，后者能维护更多的信息且更好写。但是 DFS / BFS
无法处理有负权的情况。</p>
<p><a target="_blank" rel="noopener" href="https://www.luogu.com.cn/problem/P5536">核心城市</a></p>
<p>题目要求 <span class="math inline">\(k\)</span>
座城市建到一条链上。最小化最大距离，很容易想到是直径。</p>
<p>所以两次 DFS 求出直径，在第二次 DFS
时标记出直径上的父子关系，然后求出直径中点。</p>
<p>以直径中点为起点进行
DFS，求出每个从每个节点以它为根的深度和出发能够到达的最大深度。</p>
<p>然后将求出的最大深度与原来在树中的深度相减再+1。</p>
<p>最后将得到的数组排序，取第 <span class="math inline">\(k+1\)</span>
大的值即可。</p>
<p> </p>
<p>删掉了一题，过不了 hexo。</p>
<hr />
<p> </p>
<p>不写了，再写就猝死了 Orz</p>
<p>直径还有好多题，以后看情况写吧。</p>
<p>接下来会把做题中心转到 DP 与数学上。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%A0%91%E4%B8%8A%E9%97%AE%E9%A2%98/" rel="tag"># 树上问题</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2021/lg3651-solution/" rel="prev" title="luogu3651 展翅翱翔之时 题解">
                  <i class="fa fa-chevron-left"></i> luogu3651 展翅翱翔之时 题解
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2021/UVa1025-solution/" rel="next" title="UVa1025 城市里的间谍 题解">
                  UVa1025 城市里的间谍 题解 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments"><div id="twikoo-comments"></div></div>
</div>
	</main>
	
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
	<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/meting@2.0.1/dist/Meting.min.js"></script>
	<div>
		<meting-js
			server="netease" 
			type="playlist" 
			id="6917863608"
			fixed="true" 
			autoplay="false"
			loop="all"
			order="random"
			preload="auto"
			list-folded="ture"
			list-max-height="500px"
			lrc-type="1">
		</meting-js>	
	</div>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Sz_zUwu</span>
</div>
<div class="busuanzi-count">
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.5.0/pjax.min.js" integrity="sha256-3NkoLDrmHLTYj7csHIZSr0MHAFTXth7Ua/DDt4MRUAg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>


  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


  <script src="https://cdn.jsdelivr.net/npm/quicklink@2.2.0/dist/quicklink.umd.js" integrity="sha256-4kQf9z5ntdQrzsBC3YSHnEz02Z9C1UeW/E9OgnvlzSY=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://miku01ck.xyz/2021/natsu-TRpr1/"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<script class="next-config" data-name="twikoo" type="application/json">{"enable":true,"visitor":false,"envId":"myhexo-0g6qpsti0d3fe3af","el":"#twikoo-comments"}</script>
<script>
document.addEventListener('page:loaded', () => {
  NexT.utils.loadComments(CONFIG.twikoo.el)
    .then(() => NexT.utils.getScript(
      'https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js',
      { condition: window.twikoo }
    ))
    .then(() => {
      twikoo.init(CONFIG.twikoo);
    });
});
</script>

</body>
</html>
